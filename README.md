# gene_version_mapper

### Usage of Custom Scripts for Gene Mapping

This explains the usage of the custom Python scripts developed to refine the gene map between *Fragaria vesca* genome versions v4.0 and v6.

#### 1. `parse_trees_and_groups.py`: Parsing OrthoFinder Results and Generating Ortholog Pairs

This script parses the gene trees generated by OrthoFinder and integrates them with information from the Orthogroups.tsv file to generate a comprehensive list of ortholog pairs.
The script handles cases where gene trees may be missing, relying on orthogroup counts to define relationships in such cases.

##### **Input Files**

*   **OrthoFinder Result Directory:** The main directory containing the results of an OrthoFinder run. This directory should contain the following subdirectories and files:
    *   `Gene_Trees/`: Contains the gene tree files in Newick format (e.g., `OG0001234_tree.txt`).
    *   `Orthogroups/Orthogroups.tsv`: The tab-separated file that contains information about which genes are in which orthogroups.

##### **Usage**

```bash
python parse_trees_and_groups.py <orthofinder_results_dir> <species1_id> <species2_id> <species1_prefix> <species2_prefix> <output_file.csv>
```

*   `<orthofinder_results_dir>`:  The path to the directory containing the OrthoFinder results (e.g., `orthofinder_results/`).
*   `<species1_id>`: The species ID for the first species (e.g., `Fvesca_v4.fasta` -> `Fvesca_v4`). This should match with the filename used for OrthoFinder.
*   `<species2_id>`:  The species ID for the second species (e.g., `Fvesca_v6.fasta`-> `Fvesca_v6`). This should match with the filename used for OrthoFinder.
*   `<species1_prefix>`: This prefix should match the prefix of the gene IDs used in the input FASTA files provided to OrthoFinder.
*   ` <species2_prefix>`: This prefix should also match the prefix of the gene IDs.
*   `<output_file.csv>`: The desired name for the output CSV file containing the ortholog pairs.

##### **Example**

```bash
python parse_trees_and_groups.py orthoFinder_results/ Fragaria_vesca_v4.0.a2 Fragaria_vesca_v6 Fragaria_vesca_v4 Fragaria_vesca_v6 v4_v6_orthologs.csv
```

##### **Output**

The script generates a CSV file with the following columns:

*   `s1_gene`: Gene ID from species 1.
*   `s2_gene`: Gene ID from species 2.
*   `relationship`: Type of relationship (`phylo_one-to-one`, `phylo_one-to-many`, `count_one-to-one`, etc.).
*   `distance`: Phylogenetic distance between the two genes (only for phylogenetic pairs, -1 for count-based pairs).
*   `orthogroup`: Orthogroup ID.

---

#### 2. `integrate_results.py`: Integrating Phylogenetic and Syntenic Evidence

This script integrates the phylogenetic-based ortholog pairs generated by `parse_trees_and_groups.py` with the syntenic gene pairs identified by MCScanX.
It prioritizes syntenic pairs and uses phylogenetic information to refine the mapping where synteny is absent.

##### **Input Files**

*   **Phylogenetic Pair List:** The CSV file generated by `parse_trees_and_groups.py` (e.g., `v4_v6_orthologs.csv`).
*   **Synteny Pair List:** A tab-separated file containing the syntenic gene pairs. This file must be generated from the output of MCScanX (`.collinearity` file) by extracting the relevant columns (e.g., column 3 and 4) and saving as tab-separated values. The header is not required.
    *   **MCScanX Input:** This script requires the MCScanX results. You can generate a list of syntenic pairs with a command like:
        ```bash
        awk '!/^#/ {print $3 "\t" $4}' your_mcscanx_output.collinearity > v4_v6_synteny_pairs.tsv
        ```

##### **Usage**

```bash
python integrate_results.py <phylo_pairs.csv> <synteny_pairs.tsv> <output_final.csv>
```

*   `<phylo_pairs.csv>`: The path to the CSV file generated by `parse_trees_and_groups.py`.
*   `<synteny_pairs.tsv>`:  The path to the tab-separated file containing the syntenic pairs (generated from MCScanX).
*   `<output_final.csv>`:  The desired name for the output CSV file containing the integrated and refined ortholog map.

##### **Example**

```bash
python integrate_results.py v4_v6_orthologs.csv v4_v6_synteny_pairs.tsv v4_v6_mapping_final.csv
```

##### **Output**

The script generates a CSV file with the following columns:

*   `s1_gene`: Gene ID from species 1.
*   `s2_gene`: Gene ID from species 2.
*   `relationship`: Describes how the pair was determined (e.g., "Syntenic & Phylogenetic match", "Phylogenetic only").
*   `distance`: Phylogenetic distance between the genes.
*   `orthogroup`: Orthogroup ID.
*   `is_syntenic`: True/False, indicating whether the pair is supported by synteny.

---

#### 3. `polish_mapping_list.py`: Polishing the Ortholog Map

This script filters the integrated ortholog map to remove low-confidence pairs that might be mis-assigned.
Specifically, it removes pairs where a gene in species 2 is already confidently assigned to a different gene in species 1.

##### **Input File**

*   **Integrated Mapping List:** The CSV file generated by `integrate_results_v2.py` (e.g., `v4_v6_mapping_final.csv`).

##### **Usage**

```bash
python polish_mapping_list.py <input_final_mapping.csv> <output_polished_mapping.csv>
```

*   `<input_final_mapping.csv>`: The path to the CSV file generated by `integrate_results_v2.py`.
*   `<output_polished_mapping.csv>`:  The desired name for the output CSV file containing the polished ortholog map.

##### **Example**

```bash
python polish_mapping_list.py v4_v6_mapping_final.csv v4_v6_mapping_polished.csv
```

##### **Output**

The script generates a CSV file containing the refined ortholog map, removing low-confidence pairs that are likely mis-assignments, to produce the final ortholog map.
The output file has the same columns as the input file.
